<!-- I'm Game Users -->
<div class="row" id="userCollection">
  <div ng-controller="ImGameController">
  <h4 class="imgameTitle">Users waiting to play {{ gameTitle }}</h4>
    <div ng-repeat="user in data.users">
      <div class="col s2">
        <div class="imgameUser">
          <p class="white-text">{{ user.nickname }}</p>
          <a target="_blank" href="#/profiles/{{user.nickname}}"><p><span class="im-game-inline teal darken-1">View Collection</span></p></a>
          <a href="mailto:{{ user.email }}"><p class="white-text"><span class="im-game-inline teal darken-1">Email User</span></p></a>
        </div>
      </div>
    </div> <!-- End of ngRepeat -->
  </div>
  <input type="hidden" id="gametitle" value="{{gameTitle}}" />
</div>

 <div class='container' style='background-color: white; padding: 20px 40px;'>
    <div class='row'>
      <div class='col-md-4'>
        <div class='well'><h3>Online Users</h3><div class='list-group' id='users'></div></div>
      </div>
      <div class='col-md-8'><div class='chat' id='chat'></div>
      <form id='messageForm'>
        <div class='form-group'>
          <label>Enter Message</label>
          <textarea class='form-control' id='message'></textarea>
          <input type="submit" class='btn btn-primary' value='Send Message' name="" />
        </div>
      </form></div>
    </div>
  </div>


<!--   <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script> -->
  <script>
    // var socket = io.connect('http://localhost:8080');
    // socket.on('news', function (data) {
    //   console.log("Socket here!");
    //   socket.emit('my other event', { my: 'data' });
    // });
    $(function(){
      var socket = io.connect();
      var $messageForm = $('#messageForm');
      var $message = $('#message');
      var $chat = $('#chat');
      var user = localStorage.getItem('name')
      console.log();
      //var namespace = io('/imgame');
      var gametitle = document.getElementById("gametitle").value;
      console.log('gametitle?', gametitle);

      socket.on('connect', function(){
        socket.emit('room', gametitle);
      });

      $messageForm.submit(function(e){
        e.preventDefault();
        console.log('Submitted');
        socket.emit('send message', {message: user + ': ' + $message.val(), room: gametitle})//user + ': ' + $message.val());
        $message.val('');
      });

      socket.on('new message', function(data) {
        $chat.append('<div class="well">'+data.msg+'</div>')
      });

      socket.on('message', function(data) {
        console.log('incoming message', data);
      })

    });
  </script>

